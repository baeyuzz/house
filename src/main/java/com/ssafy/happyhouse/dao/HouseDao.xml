<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.ssafy.happyhouse.dao.HouseDao">

	<select id="searchAll"
		parameterType="HousePageBean"
		resultType="HouseDeal">
		select
			d.no 			as no
			,d.address		as address
			,d.dealDate		as dealDate
    		,d.aptName		as aptName
    		,d.area			as area
    		,d.floor		as floor
    		,d.buildYear	as buildYear
    		,d.dealAmount	as dealAmount
    		,d.rentmoney	as rentMoney
    		,d.type			as type
		from
			housedeal d join houseinfo i
    		on d.address = i.address
    		and d.aptName = i.aptName
		where
			type in(${typeInStr})
			<if test="address != null">
				and d.address like concat('%', #{address}, '%')
			</if>
			<if test="aptName != null">
	    		and d.aptName like concat('%', #{aptName}, '%')
			</if>
		order by
			${orderBy} ${orderType}
		limit
			${start}, ${interval}
	</select>
	
	<select id="search"
		resultType="HouseDeal">
		select
			d.no 			as no
			,d.address		as address
			,d.dealDate		as dealDate
    		,d.aptName		as aptName
    		,d.area			as area
    		,d.floor		as floor
    		,d.buildYear	as buildYear
    		,d.dealAmount	as dealAmount
    		,d.rentmoney	as rentMoney
    		,d.type			as type
		from
			housedeal d join houseinfo i
    		on d.address = i.address
    		and d.aptName = i.aptName
		where
			d.no = #{value}

	</select>
	
	<select id="numberOfData"
		parameterType="HousePageBean"
		resultType="int">
		select
			count(*) as cnt
		from
			housedeal d join houseinfo i
    		on d.address = i.address
    		and d.aptName = i.aptName
    	<where>
    		type in(${typeInStr})
			<if test="address != null">
				and d.address like concat('%', #{address}, '%')
			</if>
			<if test="aptName != null">
	    		and d.aptName like concat('%', #{aptName}, '%')
			</if>
    	</where>
	</select>
	
	<select id="chartData"
		resultType="HouseDeal">
		select
			d.no 			as no
			,d.dealDate		as dealDate
    		,d.dealAmount	as dealAmount
    		,d.rentmoney	as rentMoney
		from
			housedeal d join houseinfo i
    		on d.address = i.address
    		and d.aptName = i.aptName
		where
			d.address		= #{address}
			and d.aptName	= #{aptName}
			and d.type		= #{type}
		order by 
			dealDate
	</select>
	
	<!-- 이 아래는 데이터베이스에 좌표값을 넣기 위해 필요했던 것 -->
	<select id="address" resultType="String">
		select
			address
		from
			houseinfo
	</select>
	
	<update id="addrToLng">
		update
			houseinfo
		set
			lat 	= #{lat}
			, lng 	= #{lng}
		where
			address = #{address}
	</update>
</mapper>